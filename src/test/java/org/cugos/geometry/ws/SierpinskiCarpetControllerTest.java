package org.cugos.geometry.ws;

import io.micronaut.http.HttpRequest;
import io.micronaut.http.MediaType;
import org.junit.Test;

import java.net.URLEncoder;

import static org.junit.Assert.assertEquals;

public class SierpinskiCarpetControllerTest extends AbstractControllerTest  {

    private final String inputGeometry = "POLYGON ((0 0, 0 10, 10 10, 10 0, 0 0))";

    private final String resultGeometry = "POLYGON ((0 0, 0 10, 10 10, 10 0, 0 0), (1.1111111111111112 "
        + "1.1111111111111112, 2.2222222222222223 1.1111111111111112, "
        + "2.2222222222222223 2.2222222222222223, 1.1111111111111112 "
        + "2.2222222222222223, 1.1111111111111112 1.1111111111111112), "
        + "(4.444444444444445 1.1111111111111112, 5.555555555555555 1.1111111111111112, "
        + "5.555555555555555 2.2222222222222223, 4.444444444444445 2.2222222222222223, "
        + "4.444444444444445 1.1111111111111112), (7.777777777777779 1.1111111111111112, "
        + "8.88888888888889 1.1111111111111112, 8.88888888888889 2.2222222222222223, "
        + "7.777777777777779 2.2222222222222223, 7.777777777777779 1.1111111111111112), "
        + "(1.1111111111111112 4.444444444444445, 2.2222222222222223 4.444444444444445, "
        + "2.2222222222222223 5.555555555555555, 1.1111111111111112 5.555555555555555, "
        + "1.1111111111111112 4.444444444444445), (7.777777777777779 4.444444444444445, "
        + "8.88888888888889 4.444444444444445, 8.88888888888889 5.555555555555555, "
        + "7.777777777777779 5.555555555555555, 7.777777777777779 4.444444444444445), "
        + "(1.1111111111111112 7.777777777777779, 2.2222222222222223 7.777777777777779, "
        + "2.2222222222222223 8.88888888888889, 1.1111111111111112 8.88888888888889, 1.1111111111111112 "
        + "7.777777777777779), (4.444444444444445 7.777777777777779, 5.555555555555555 7.777777777777779, "
        + "5.555555555555555 8.88888888888889, 4.444444444444445 8.88888888888889, 4.444444444444445 "
        + "7.777777777777779), (7.777777777777779 7.777777777777779, 8.88888888888889 7.777777777777779, "
        + "8.88888888888889 8.88888888888889, 7.777777777777779 8.88888888888889, 7.777777777777779 "
        + "7.777777777777779), (3.3333333333333335 3.3333333333333335, 6.666666666666667 "
        + "3.3333333333333335, 6.666666666666667 6.666666666666667, 3.3333333333333335 "
        + "6.666666666666667, 3.3333333333333335 3.3333333333333335))";

    @Test
    public void get() throws Exception {
        HttpRequest request = HttpRequest.GET("/sierpinskiCarpet/wkt/wkt?number=30&geom=" + URLEncoder.encode(inputGeometry, "UTF-8"));
        String geometry = client.toBlocking().retrieve(request);
        assertEquals(resultGeometry, geometry);
    }

    @Test
    public void post() throws Exception {
        HttpRequest request = HttpRequest.POST("/sierpinskiCarpet/wkt/wkt?number=30", inputGeometry).contentType(MediaType.TEXT_PLAIN_TYPE);
        String geometry = client.toBlocking().retrieve(request);
        assertEquals(resultGeometry, geometry);
    }

}
